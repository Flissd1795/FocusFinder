@using System.Linq
@model FocusFinderApp.Models.Location
@{
    ViewData["Title"] = "Location";
}

<head>
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
</head>

<div class="i-body-top body-top">
    <div class="text-center">
        <h1 class="display-4">@Model.LocationName</h1>
    </div>
</div>

<!-- Main Location Container -->
<div>

    <!-- Mark as Visited -->
    <div>
        <form asp-controller="Location" asp-action="AddVisit" method="post">
            <input type="hidden" name="LocationId" value="@Model.Id" />
            <button type="submit" class="btn btn-primary">I've been here!</button>
        </form>
    </div>

    <!-- Bio -->
    <div> 
        <h5>About @Model.LocationName</h5>
        @* <p>@ViewBag.Location.Description</p> TESTING *@
        <p>@Model.Description</p>
    </div>

    <!-- Image -->
    <div class="i-study-pic-container glow-back">
        @{
            Console.WriteLine("image: " + @ViewBag.imageName);
            var ifImage = "/images/noimagefound.jpg";
            if (@Model.ImageURL != null){
                ifImage = @Model.ImageURL;
            }
        }
        <img src="@Url.Content(ifImage)" alt="Image of @Model.LocationName location.">
    </div>


    <!-- Reviews Section -->
    <div>
        @* @if (ViewBag.Location.Reviews != null && ViewBag.Location.Reviews.Any()) *@
        @{
            var reviews = Model.Reviews as IEnumerable<FocusFinderApp.Models.Review>;
        }

        <h5>Reviews - Overall @ViewBag.AverageRating ⭐</h5>
        @if (reviews?.Any() == true)
        {
            <ul>
                @foreach (var review in reviews)
                {
                    <li>Rating: @review.overallRating ⭐ | Posted on: @review.dateLastUpdated?.ToString("MMM dd, yyyy")</li>
                }
            </ul>
        }
        else
        {
            <p>No reviews yet. Be the first to review!</p>
        }
        <!-- Add Review Form -->
        <form asp-controller="Location" asp-action="AddReview" method="post">
            <input type="hidden" name="LocationId" value="@Model.Id" />
            <label for="rating">Your Rating (1-5):</label>
            <select name="Rating" id="rating" required>
                <option value="1">1 ⭐</option>
                <option value="2">2 ⭐</option>
                <option value="3">3 ⭐</option>
                <option value="4">4 ⭐</option>
                <option value="5">5 ⭐</option>
            </select>
            <button type="submit">Submit Review</button>
        </form>
    </div>

    <!-- Address/Map << Advanced -->
    <div>
        <h5>Where even is it?</h5>
        <p>@Model.BuildingIdentifier @Model.StreetAddress</p>
        <p>@Model.City</p>
        <p>@Model.County</p>
        <p>@Model.Postcode</p>
    </div>

    <!-- URL for Location's own webapage <<- Ideal/Advanced-->
    <div>
        <h5>Find out more information here:</h5>
        <p>✨URL tbc✨</p>
        <p>(awaiting column in Locations table)</p>
    </div>

</div>